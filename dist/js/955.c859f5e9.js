"use strict";(self["webpackChunktravelholic"]=self["webpackChunktravelholic"]||[]).push([[955],{8892:function(t,e,a){a.d(e,{Z:function(){return A}});var l=a(3396),i=a(7139),s=a(9242);const n={class:"modal",tabindex:"-1",ref:"modal"},o={class:"modal-dialog"},c={class:"modal-content"},d={class:"modal-header bg-danger text-white"},r={class:"modal-title"},p=["disabled"],u={class:"modal-body"},h={class:"modal-footer"},m=["disabled"],g=["disabled"];function b(t,e,a,b,_,v){return(0,l.wg)(),(0,l.iD)("div",n,[(0,l._)("div",o,[(0,l._)("div",c,[(0,l._)("div",d,[(0,l._)("h5",r,"是否刪除 "+(0,i.zw)(a.title),1),(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",disabled:_.btnDisabled},null,8,p)]),(0,l._)("div",u,[(0,l._)("p",null,"確定要刪除 "+(0,i.zw)(a.title)+" 嗎？（刪除後無法恢復）",1)]),(0,l._)("div",h,[(0,l._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",disabled:_.btnDisabled}," 取消 ",8,m),(0,l._)("button",{type:"button",class:"btn btn-danger",disabled:_.btnDisabled,onClick:e[0]||(e[0]=(0,s.iM)(((...t)=>v.deleteItem&&v.deleteItem(...t)),["prevent"]))},"確認刪除",8,g)])])])],512)}var _=a(7972),v=a.n(_),f={props:["title"],data(){return{modal:{},btnDisabled:!1}},methods:{showModal(){this.btnDisabled=!1,this.modal.show()},hideModal(){this.modal.hide()},deleteItem(){this.btnDisabled=!0,this.$emit("delete-item")}},mounted(){this.modal=new(v())(this.$refs.modal)}},w=a(89);const y=(0,w.Z)(f,[["render",b]]);var A=y},6832:function(t,e,a){a.d(e,{Z:function(){return y}});var l=a(3396),i=a(7139),s=a(9242);const n={"aria-label":"Page navigation"},o={class:"pagination justify-content-center"},c=(0,l._)("span",{"aria-hidden":"true"},"«",-1),d=[c],r=(0,l._)("span",{"aria-hidden":"true"},"‹",-1),p=[r],u=["onClick"],h=(0,l._)("span",{"aria-hidden":"true"},"›",-1),m=[h],g=(0,l._)("span",{"aria-hidden":"true"},"»",-1),b=[g];function _(t,e,a,c,r,h){return(0,l.wg)(),(0,l.iD)("nav",n,[(0,l._)("ul",o,[(0,l._)("li",{class:(0,i.C_)(["page-item",{disabled:!a.pagination.has_pre}])},[(0,l._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=(0,s.iM)((t=>h.updatePage(1)),["prevent"]))},d)],2),(0,l._)("li",{class:(0,i.C_)(["page-item",{disabled:!a.pagination.has_pre}])},[(0,l._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[1]||(e[1]=(0,s.iM)((t=>h.updatePage(a.pagination.current_page-1)),["prevent"]))},p)],2),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.pagination.total_pages,(t=>((0,l.wg)(),(0,l.iD)("li",{class:"page-item",key:t},[(0,l._)("a",{class:(0,i.C_)(["page-link",{active:t===a.pagination.current_page}]),href:"#",onClick:(0,s.iM)((e=>h.updatePage(t)),["prevent"])},(0,i.zw)(t),11,u)])))),128)),(0,l._)("li",{class:(0,i.C_)(["page-item",{disabled:!a.pagination.has_next}])},[(0,l._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[2]||(e[2]=(0,s.iM)((t=>h.updatePage(a.pagination.current_page+1)),["prevent"]))},m)],2),(0,l._)("li",{class:(0,i.C_)(["page-item",{disabled:!a.pagination.has_next}])},[(0,l._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[3]||(e[3]=(0,s.iM)((t=>h.updatePage(a.pagination.total_pages)),["prevent"]))},b)],2)])])}var v={props:{pagination:{type:Object}},methods:{updatePage(t){this.$emit("update-page",t)}}},f=a(89);const w=(0,f.Z)(v,[["render",_]]);var y=w},5955:function(t,e,a){a.r(e),a.d(e,{default:function(){return tt}});var l=a(3396),i=a(9242),s=a(7139);const n={class:"text-end mt-3"},o={class:"table"},c=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",{class:"col-2"},"標題"),(0,l._)("th",{class:"col-1"},"作者"),(0,l._)("th",null,"建立時間"),(0,l._)("th",null,"tag"),(0,l._)("th",{class:"col-3"},"文章說明"),(0,l._)("th",{class:"text-center"},"公開"),(0,l._)("th",null,"編輯")])],-1),d={key:0,class:"list-unstyled"},r={class:"text-center"},p={key:0,class:"text-success"},u={key:1,class:"text-secondary"},h=["onClick"],m=["onClick"];function g(t,e,a,g,b,_){const v=(0,l.up)("Loading"),f=(0,l.up)("ArticleModal"),w=(0,l.up)("DeleteModal"),y=(0,l.up)("Pagination");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(v,{active:b.isLoading,style:{"z-index":"9999"}},null,8,["active"]),(0,l._)("div",n,[(0,l._)("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(0,i.iM)((t=>_.openModal(!0)),["prevent"]))}," 新增文章 ")]),(0,l._)("table",o,[c,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(b.articles,((e,a)=>((0,l.wg)(),(0,l.iD)("tr",{key:a},[(0,l._)("td",null,(0,s.zw)(e.title),1),(0,l._)("td",null,(0,s.zw)(e.author),1),(0,l._)("td",null,(0,s.zw)(t.$filters.date(e.create_at)),1),(0,l._)("td",null,[e.tag?((0,l.wg)(),(0,l.iD)("ul",d,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.tag,((t,e)=>((0,l.wg)(),(0,l.iD)("li",{key:e},(0,s.zw)(`${t},`),1)))),128))])):(0,l.kq)("",!0)]),(0,l._)("td",null,(0,s.zw)(e.description),1),(0,l._)("td",r,[e.isPublic?((0,l.wg)(),(0,l.iD)("span",p,"已公開")):((0,l.wg)(),(0,l.iD)("span",u,"不公開"))]),(0,l._)("td",null,[(0,l._)("button",{class:"btn btn-outline-primary btn-sm",onClick:(0,i.iM)((t=>_.openModal(!1,e.id)),["prevent"])}," 編輯 ",8,h),(0,l._)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>_.openDeleteModal(e)},"刪除",8,m)])])))),128))])]),(0,l.Wm)(f,{ref:"articleModal",article:b.tempArticle,onUpdateArticle:_.updateArticle},null,8,["article","onUpdateArticle"]),(0,l.Wm)(w,{ref:"deleteModal",title:b.tempArticle.title,onDeleteItem:_.deleteArticle},null,8,["title","onDeleteItem"]),(0,l.Wm)(y,{pagination:b.pagination,onUpdatePage:_.getArticle},null,8,["pagination","onUpdatePage"])],64)}const b={class:"modal",tabindex:"-1",ref:"modal"},_={class:"modal-dialog modal-xl modal-dialog-scrollable"},v={class:"modal-content"},f=(0,l._)("div",{class:"modal-header"},[(0,l._)("h5",{class:"modal-title"},"編輯文章"),(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),w={class:"modal-body"},y={class:"row"},A={class:"col-md-4"},k={class:"mb-2"},M=(0,l._)("label",{for:"title",class:"form-label"},"文章標題",-1),x={class:"mb-2"},D=(0,l._)("label",{for:"author",class:"form-label"},"作者",-1),C={class:"mb-2"},$=(0,l._)("label",{for:"tag",class:"form-label"},"tag",-1),P={class:"mt-2"},L=["onMouseenter","onClick"],z={class:"mb-2"},H=(0,l._)("label",{for:"description",class:"form-label"},"文章說明",-1),T={class:"mb-2"},U=(0,l._)("label",{for:"image",class:"form-label"},"封面圖片",-1),Z=["src"],V={class:"col-md-8"},Y={class:"mb-2"},I=(0,l._)("label",{for:"content",class:"form-label"},"文章內容",-1),K={class:"modal-footer justify-content-between"},N={class:"form-check"},W=(0,l._)("label",{for:"isPublic",class:"form-check-label"},"公開文章",-1),j=(0,l._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function F(t,e,a,n,o,c){const d=(0,l.up)("Loading");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(d,{active:o.isLoading,style:{"z-index":"9999"}},null,8,["active"]),(0,l._)("div",b,[(0,l._)("div",_,[(0,l._)("div",v,[f,(0,l._)("div",w,[(0,l._)("div",y,[(0,l._)("div",A,[(0,l._)("div",k,[M,(0,l.wy)((0,l._)("input",{type:"text",id:"title",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>o.tempArticle.title=t)},null,512),[[i.nr,o.tempArticle.title]])]),(0,l._)("div",x,[D,(0,l.wy)((0,l._)("input",{type:"text",id:"author",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=t=>o.tempArticle.author=t)},null,512),[[i.nr,o.tempArticle.author]])]),(0,l._)("div",C,[$,(0,l.wy)((0,l._)("input",{type:"text",id:"tag",class:"form-control",placeholder:"輸入完後點擊 Enter","onUpdate:modelValue":e[2]||(e[2]=t=>o.tempTag=t),onKeyup:e[3]||(e[3]=(0,i.D2)(((...t)=>c.pushTag&&c.pushTag(...t)),["enter"]))},null,544),[[i.nr,o.tempTag]]),(0,l._)("div",P,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.tempArticle.tag,((t,a)=>((0,l.wg)(),(0,l.iD)("button",{class:(0,s.C_)(["btn btn-light btn-sm",{"bg-danger-subtle":o.isHover===a}]),key:a},[(0,l._)("span",null,(0,s.zw)(t),1),(0,l._)("i",{class:"bi bi-x",onMouseenter:t=>o.isHover=a,onMouseleave:e[4]||(e[4]=t=>o.isHover=null),onClick:t=>c.spliceTag(a)},null,40,L)],2)))),128))])]),(0,l._)("div",z,[H,(0,l.wy)((0,l._)("textarea",{id:"description",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=t=>o.tempArticle.description=t)},null,512),[[i.nr,o.tempArticle.description]])]),(0,l._)("div",T,[U,(0,l._)("input",{type:"file",id:"image",class:"form-control",ref:"image",onChange:e[6]||(e[6]=e=>c.uploadFile(t.$refs.image))},null,544),o.tempArticle.image?((0,l.wg)(),(0,l.iD)("img",{key:0,src:o.tempArticle.image,alt:"封面圖片",class:"w-100 mt-2"},null,8,Z)):(0,l.kq)("",!0)])]),(0,l._)("div",V,[(0,l._)("div",Y,[I,(0,l.wy)((0,l._)("textarea",{id:"content",class:"form-control",style:{height:"300px"},"onUpdate:modelValue":e[7]||(e[7]=t=>o.tempArticle.content=t)},null,512),[[i.nr,o.tempArticle.content]])])])])]),(0,l._)("div",K,[(0,l._)("div",N,[(0,l.wy)((0,l._)("input",{type:"checkbox",id:"isPublic",class:"form-check-input","onUpdate:modelValue":e[8]||(e[8]=t=>o.tempArticle.isPublic=t)},null,512),[[i.e8,o.tempArticle.isPublic]]),W]),(0,l._)("div",null,[j,(0,l._)("button",{type:"button",class:"btn btn-primary ms-2",onClick:e[9]||(e[9]=(0,i.iM)(((...t)=>c.emitArticle&&c.emitArticle(...t)),["prevent"]))},"確定編輯")])])])])],512)],64)}a(7658);var q=a(7972),E=a.n(q),O={props:{article:{type:Object}},data(){return{modal:{},tempArticle:{tag:[],isPublic:!1},tempTag:"",isHover:null,isLoading:!1}},watch:{article(){this.tempArticle=this.article}},emits:["update-article"],methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()},pushTag(){this.tempArticle.tag.push(this.tempTag),this.tempTag=""},spliceTag(t){this.tempArticle.tag.splice(t,1),this.isHover=null},uploadFile(t){this.isLoading=!0;const e=t.files[0],a=new FormData;a.append("file-to-upload",e);const l="https://vue3-course-api.hexschool.io/api/yanni-hexschool-api/admin/upload";this.$http.post(l,a).then((t=>{this.isLoading=!1,console.log(t.data),this.tempArticle.image=t.data.imageUrl}))},emitArticle(){this.tempArticle.create_at=(new Date).getTime()/1e3,this.$emit("update-article",this.tempArticle)}},mounted(){this.modal=new(E())(this.$refs.modal)}},B=a(89);const G=(0,B.Z)(O,[["render",F]]);var J=G,Q=a(8892),R=a(6832),S={data(){return{articles:{},pagination:{},tempArticle:{},isLoading:!1,isNew:!1}},components:{ArticleModal:J,DeleteModal:Q.Z,Pagination:R.Z},methods:{getArticle(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/yanni-hexschool-api/admin/articles/?page=${t}`;this.$http.get(e).then((t=>{this.isLoading=!1,console.log(t.data),this.articles=t.data.articles,this.pagination=t.data.pagination}))},openModal(t,e){if(this.isNew=t,!t)return this.isLoading=!0,new Promise(((t,a)=>{const l=`https://vue3-course-api.hexschool.io/api/yanni-hexschool-api/admin/article/${e}`;this.$http.get(l).then((e=>{if(e.data.success)console.log(e.data),this.tempArticle=e.data.article,t();else{const t=new Error("取得文章內容失敗");a(t)}}))})).then((()=>{this.isLoading=!1,this.$refs.articleModal.showModal()}));this.tempArticle={tag:[],isPublic:!1},this.$refs.articleModal.showModal()},updateArticle(t){this.isLoading=!0,this.tempArticle=t;let e="https://vue3-course-api.hexschool.io/api/yanni-hexschool-api/admin/article",a="post";this.isNew||(e=`https://vue3-course-api.hexschool.io/api/yanni-hexschool-api/admin/article/${t.id}`,a="put"),this.$http[a](e,{data:this.tempArticle}).then((t=>{this.isLoading=!1,console.log(t.data),this.$refs.articleModal.hideModal(),this.getArticle()}))},openDeleteModal(t){this.tempArticle=t,this.$refs.deleteModal.showModal()},deleteArticle(){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/yanni-hexschool-api/admin/article/${this.tempArticle.id}`;this.$http.delete(t).then((t=>{this.isLoading=!1,console.log(t.data),this.$refs.deleteModal.hideModal(),this.getArticle()}))}},created(){this.getArticle()}};const X=(0,B.Z)(S,[["render",g]]);var tt=X}}]);
//# sourceMappingURL=955.c859f5e9.js.map